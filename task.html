<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tasks</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css"/>
    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <style>
        /* --- LOGO STYLES --- */
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .logo {
            max-width: 150px; 
            height: auto;
            cursor: pointer;
        }

        /* --- PROGRESS BAR SECTION --- */
        .progress-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            max-width: 650px; 
            margin-left: auto;
            margin-right: auto;
        }

        /* Avatar Box */
        .avatar-box {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4f8;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .avatar-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Text*/
        .progress-text {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
            min-width: 70px; 
            text-align: right; 
            white-space: nowrap; 
        }

        /* WRAPPER FOR HOVER EFFECT --- */
        .progress-wrapper {
            flex-grow: 1;
            position: relative; 
            cursor: pointer;
        }

        /* The Tooltip (Hidden by default) */
        .progress-wrapper::after {
            content: attr(data-percent); 
            position: absolute;
            top: -35px; 
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0; 
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        /* Show Tooltip on Hover */
        .progress-wrapper:hover::after {
            opacity: 1;
        }

        /* Progress Bar Container */
        .progress-track {
            height: 12px;
            background-color: #e5e5e5;
            border-radius: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #81C784);
            width: 0%;
            border-radius: 20px;
            transition: width 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        /* --- TASK LIST STYLES --- */
        .task-input-area {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        #taskInput {
            padding: 12px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            width: 250px;
            font-size: 1rem;
        }
        
        #difficultySelect {
            padding: 12px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
        }

        #addTaskBtn {
            padding: 12px 24px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        #addTaskBtn:hover { opacity: 0.9; }

        #taskList {
            list-style: none;
            padding: 0;
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
        }

        .task-item {
            background: #f9fafb;
            border: 1px solid #e5e5e5;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.5s ease;
            opacity: 1;
        }

        .task-item.fade-out {
            opacity: 0;
            transform: translateX(50px);
            background-color: #e6f4ea;
        }

        .task-left { display: flex; align-items: center; gap: 12px; }
        .task-text { font-size: 1.05rem; font-weight: 500; }

        .badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        .badge-low { background: #e6f4ea; color: #137333; }
        .badge-med { background: #feefc3; color: #b06000; }
        .badge-hard { background: #fce8e6; color: #c5221f; }

        .delete-btn {
            background: none;
            border: none;
            color: #9aa0a6;
            cursor: pointer;
            padding: 5px;
        }
        .delete-btn:hover { color: #d93025; }

        input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: #4CAF50; }
    </style>
</head>
<body>
    <div class="page-container">
        
        <div class="logo-container">
            <a href="home.html" title="Home">
                <img src="Graphics/LEMONEY%20logo.png" alt="Lemoney logo" class="logo">
            </a>
        </div>

        <nav class="nav-bar">
            <a href="home.html" class="nav-link">Home</a>
            <a href="budget.html" class="nav-link">Budget</a>
            <a href="task.html" class="nav-link active">Task</a>
            <a href="shop.html" class="nav-link">Shop</a>
        </nav>

        <div class="progress-section">
            <div id="avatarBox" class="avatar-box">
                <img id="avatarImg" src="Graphics/lemonie front view.png" alt="Avatar">
            </div>
            
            <div id="progressWrapper" class="progress-wrapper" data-percent="0%">
                <div class="progress-track">
                    <div id="progressBar" class="progress-fill"></div>
                </div>
            </div>

            <div id="progressText" class="progress-text">0/0</div>
        </div>

        <div class="task-input-area">
            <input type="text" id="taskInput" placeholder="Add a new task..." />
            <select id="difficultySelect">
                </select>
            <button id="addTaskBtn">Add Task</button>
        </div>

        <ul id="taskList">
        </ul>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const spending_pool = 0.2 * 2000; // 400
        
        const lowPts = Math.round(spending_pool * 0.01);  // 4
        const medPts = Math.round(spending_pool * 0.02);  // 8
        const hardPts = Math.round(spending_pool * 0.03); // 12

        // --- 2. UPDATE DROPDOWN ---
        const difficultySelect = document.getElementById('difficultySelect');
        difficultySelect.innerHTML = `
            <option value="${lowPts}">Low (${lowPts} pts)</option>
            <option value="${medPts}">Medium (${medPts} pts)</option>
            <option value="${hardPts}">Hard (${hardPts} pts)</option>
        `;

        // --- 3. ELEMENTS ---
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');
        
        const progressBar = document.getElementById('progressBar');
        const progressWrapper = document.getElementById('progressWrapper'); 
        const progressText = document.getElementById('progressText');
        const avatarBox = document.getElementById('avatarBox');
        const avatarImg = document.getElementById('avatarImg');

        const myImages = [
            'Graphics/lemonie front view.png', 
            'Graphics/lemonie happy.png', 
            'Graphics/lemonie satisfied.png',
            'Graphics/lemonie talks.png',
            'Graphics/lemonie front view.png'
        ];
        
        let avatarIndex = 0;

        // LOAD SCORE
        let currentLifetimeScore = parseInt(localStorage.getItem('cloudUserScore')) || 0;
        updateProgressUI();

        function updateProgressUI() {
            // Update Text
            progressText.textContent = `${currentLifetimeScore}/${spending_pool}`;
            
            // Calculate Percentage
            let percent = (currentLifetimeScore / spending_pool) * 100;
            if (percent > 100) percent = 100;
            
            // Update Bar Width
            progressBar.style.width = `${percent}%`;

            // Update Tooltip Text (The hover number)
            progressWrapper.setAttribute('data-percent', Math.round(percent) + '%');
        }

        function cycleAvatar() {
            avatarIndex = (avatarIndex + 1) % myImages.length; 
            
            avatarBox.style.transform = "scale(0.8) rotate(10deg)";
            setTimeout(() => {
                avatarImg.src = myImages[avatarIndex];
                avatarBox.style.transform = "scale(1.1) rotate(0deg)";
            }, 150);
            setTimeout(() => {
                avatarBox.style.transform = "scale(1)";
            }, 300);
        }

        function addTask() {
            const text = taskInput.value;
            const points = parseInt(difficultySelect.value); 
            
            if (text === "") {
                alert("Please write a task name!");
                return;
            }

            let badgeClass = 'badge-low';
            let difficultyLabel = 'Low';
            
            if(points === medPts) { 
                badgeClass = 'badge-med'; 
                difficultyLabel = 'Medium'; 
            }
            if(points === hardPts) { 
                badgeClass = 'badge-hard'; 
                difficultyLabel = 'Hard'; 
            }

            const li = document.createElement('li');
            li.className = 'task-item';
            
            li.innerHTML = `
                <div class="task-left">
                    <input type="checkbox" class="complete-checkbox">
                    <div>
                        <span class="task-text">${text}</span>
                        <span class="badge ${badgeClass}">${difficultyLabel} (${points} pts)</span>
                    </div>
                </div>
                <button class="delete-btn"><i class="fa-solid fa-trash"></i></button>
            `;

            const checkbox = li.querySelector('.complete-checkbox');
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    currentLifetimeScore += points;
                    localStorage.setItem('cloudUserScore', currentLifetimeScore);

                    updateProgressUI();
                    cycleAvatar(); 

                    li.classList.add('fade-out');
                    setTimeout(() => { li.remove(); }, 500); 
                }
            });

            const deleteBtn = li.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', function() {
                li.remove();
            });

            taskList.appendChild(li);
            taskInput.value = "";
        }

        addTaskBtn.addEventListener('click', addTask);
        
        taskInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addTask();
        });

    </script>
    <script src="tour.js"></script>
</body>
</html>